name: Auto Update Socksproxy Secret

on:
  repository_dispatch: # API 触发：通过 POST 请求到 GitHub API 触发
    types: [run_ip2free]
  workflow_dispatch:        # 支持手动点运行

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: pip install requests pynacl

      - name: Run Sync Script
        env:
          GH_PAT: ${{ secrets.GH_PAT }}
          IP2FREE_ACCOUNTS: ${{ secrets.IP2FREE_ACCOUNTS }}
        # 使用 python -u 运行
        run: python -u ip2free_fetcher.py
